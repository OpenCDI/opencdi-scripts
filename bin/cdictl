#!/bin/sh

cdictl(){

loadmod(){
  require @cdictl
}
loadenv(){
  pa_socket=$HOME/.pulse_socket
  core=dom0
}

parseargs(){
  case ${1:?argument needed!} in
    up) #[con_desc]
    #launch cdi stack
      shift;
      #display_init; 
      cdi_up ${1:+$@} ${1:-fox bird office};
      pkg_init dom0 pulseaudio
      pkg_init dom0 docker.io
      pkg_init fox pulseaudio
      pa_init ;;
    down) 
    #stop cdi stack
      shift
      cdi_down ${1:+$@} ${1:-fox bird office}; execute(){ pkill -9 X;} ;;
    *) showhelp ;;
  esac
}

execute(){
  exec docker exec -it -u duser \
    -e SHELL=/bin/bash \
    -e DISPLAY=:0 \
    -e LANG=$LANG \
    -e LC_ALL=$LANG \
    -e XMODIFIERS=@im=ibus \
    -e GTK_IM_MODULE=ibus \
    -e QT_IM_MODULE=ibus \
    ${core:-dom0} mate-session 
#    -e http_proxy=http://squid.cosh:3128 \
#    -e https_proxy=http://squid.cosh:3128 \

#  docker stop ${core:-dom0}
}

}

cook cdictl $@
