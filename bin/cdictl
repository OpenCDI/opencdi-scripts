#!/bin/sh

cdictl(){

loadmod(){
  require @cdictl
}
loadenv(){
  pa_socket=$HOME/.pulse_socket
  #core=
}

parseargs(){
  case ${1:?argument needed!} in
    up) #[con_desc]
    #launch cdi stack
      shift;
      #display_init; 
      cdi_network_launch
      cdi_up $@;
      pkg_init ${core:-dom0} pulseaudio
      pkg_init ${core:-dom0} docker.io
      #pkg_init fox pulseaudio
      ${FROM_XINIT:+pa_init} ;;
    down) 
    #stop cdi stack
      shift
      pkill -9 X; execute(){ cdi_down $@ ; } ;;
    *) showhelp ;;
  esac
}

execute(){
  exec docker exec -i ${FROM_XINIT:+-t} -u duser \
    -e SHELL=/bin/bash \
    -e DISPLAY=:0 \
    -e LANG=$LANG \
    -e LC_ALL=$LANG \
    -e XMODIFIERS=@im=ibus \
    -e GTK_IM_MODULE=ibus \
    -e QT_IM_MODULE=ibus \
    -e XDG_RUNTIME_DIR=$XDG_RUNTIME_DIR \
    ${core:-dom0} ${core_session:-mate-session}
#    -e http_proxy=http://squid.cosh:3128 \
#    -e https_proxy=http://squid.cosh:3128 \

#  docker stop ${core:-dom0}
}

}

cook cdictl $@
